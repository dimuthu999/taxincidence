---
title: 'Anchoring in Housing Market: Evidence from California Proposition 13'
author: "Dimuthu Ratnadiwakara and Vijay Yerramilli"
date: "April, 2017"
output:
  html_document:
    css: bodycss.css
    fig_width: 8
    font-family: Helvetica,Arial,sans-serif;
    number_section: yes
    toc: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
linestretch: 2
bibliography: C:\Users\dnratnadiwakara\OneDrive\library.bib
---

<style type="text/css">
body{ 
      font-size: 15px;
      font-family: Helvetica,Arial,sans-serif;
      line-height: 200%;
  }
  
.author {
 font-size: 15px;
 color: Black;
 font-style: normal;
 text-align: center;
}


.date { 
 font-size: 15px;
 color: Black;
 font-style: normal;
 text-align: center;
}

.title{
  text-align: center;
  font-size: 15px;
 color: Black;
 
}

.toc-ignore{
  text-align: center;
  font-size: 15px;
 color: Black;
}

.fluid-row{
  text-align: center;
  font-size: 15px;
 color: Black;
}

</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE,echo = FALSE,results = 'asis', fig.align='center')
```

```{r init}

rm(list=ls())
path = "E:/tax_incident/"
setwd(path)
library(plyr)
library(psych)
library(stargazer)
library(Matching)
library(sandwich)
library(ggplot2)
library(scales)
library(lubridate)
library(zoo)
library(AER)
library(lfe)
library(pracma)
library(dplyr)
library(ggmap)
library(reshape2)

output.type="html"

completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}

sold_data <- readRDS(file="ca_anchoring_5.rds")
sold_data['estimated_current_value'] <- sold_data$current_value
sold_data <- sold_data[sold_data$state %in% c("CA","IL"),]
other <- sold_data[!sold_data$state %in% c("CA"),]
sold_data <- sold_data[sold_data$state %in% c("CA"),]


sold_data <- sold_data[sold_data$sales_price>=quantile(sold_data$sales_price,0.001,na.rm = TRUE) & sold_data$sales_price<=quantile(sold_data$sales_price,0.999,na.rm = TRUE),]
sold_data['delete'] <- ifelse(sold_data$Lastremodelyear>sold_data$purchased_year,1,0)
sold_data <- sold_data[sold_data$delete ==0 | is.na(sold_data$delete),]
sold_data$delete <- NULL

sold_data <- sold_data[is.finite(log(sold_data$listing_amount)),]
sold_data <- sold_data[is.finite(log(sold_data$sales_price)),]
sold_data <- sold_data[!is.na(sold_data$zip_purchased_year),]
sold_data <- sold_data[!is.na(sold_data$zip_listed_year),]


other <- other[is.finite(log(other$listing_amount)),]
other <- other[is.finite(log(other$sales_price)),]
other <- other[!is.na(other$zip_purchased_year),]
other <- other[!is.na(other$zip_listed_year),]



# sales_price_estimate <- lm(sales_price~beds+baths+age+walk_score+Lot+avg_school_rating+avg_school_distance+listed_hpi+factor(zip_listed_year),data=sold_data)
# sold_data['estimated_value'] <- predict(sales_price_estimate)





sold_data <- completeFun(sold_data,c("sales_price","beds","baths","sqft","zip_listed_year","purchased_amount","purchased_hpi"))
other <- completeFun(other,c("sales_price","beds","baths","sqft","zip_listed_year","purchased_amount","purchased_hpi"))

purchased_price_estimate <- lm(purchased_amount~beds+baths+purchased_hpi+factor(zip_purchased_year),data=sold_data)
sold_data['estimated_purchased_price'] <- predict(purchased_price_estimate)
sold_data['purchase_price_residual'] <- sold_data$purchased_amount - sold_data$estimated_purchased_price

purchased_price_estimate <- lm(purchased_amount~beds+baths+purchased_hpi+factor(zip_purchased_year),data=other)
other['estimated_purchased_price'] <- predict(purchased_price_estimate)
other['purchase_price_residual'] <- other$purchased_amount - other$estimated_purchased_price


sold_data['tax_pct'] <- sold_data$proptax_2015/sold_data$estimated_current_value
sold_data <- sold_data[is.finite(log(sold_data$estimated_current_value)),]
sold_data <- sold_data[sold_data$tax_pct>=quantile(sold_data$tax_pct,0.001,na.rm = TRUE) & sold_data$tax_pct<=quantile(sold_data$tax_pct,0.999,na.rm = TRUE),]

other['tax_pct'] <- other$proptax_2015/other$estimated_current_value
other <- other[is.finite(log(other$estimated_current_value)),]
other <- other[other$tax_pct>=quantile(other$tax_pct,0.01,na.rm = TRUE) & other$tax_pct<=quantile(other$tax_pct,0.99,na.rm = TRUE),]


sold_data['degree_of_overpricing'] <- (sold_data$listing_amount / sold_data$estimated_current_value)
sold_data['loss'] <- sold_data$estimated_current_value - sold_data$purchased_amount
sold_data <- sold_data[sold_data$degree_of_overpricing>=quantile(sold_data$degree_of_overpricing,0.001,na.rm = TRUE) & sold_data$degree_of_overpricing<=quantile(sold_data$degree_of_overpricing,0.999,na.rm = TRUE),]

other['degree_of_overpricing'] <- (other$listing_amount / other$estimated_current_value)
other['loss'] <- other$estimated_current_value - other$purchased_amount


sold_data <- rbind(sold_data,other)
sold_data['time_on_market'] <- as.numeric(sold_data$sale_date-sold_data$listed_date)
low_liq <- 1:5
high_liq <- 6:10



note =c("Fixed Effects: zip x listed year, zip x purchased year","Standard Errors clustered by zip x listed year")
printtable <- function(reg,column.labels,depvar,note,iv,lines) {
  stargazer(reg,type=output.type,no.space = TRUE,omit.stat = c("f","rsq","ser"),notes= note,column.labels = column.labels, dep.var.labels = "",dep.var.caption   = paste("Y: ",gsub("_"," ",depvar),"; iv: ",gsub("_"," ",iv)),dep.var.labels.include = FALSE,add.lines = lines)
}


```

# Abstract
> 
* Using the exogenous property tax component due to Proposition 13 in California as an instrument, this paper investigages whether the initial listing price in house sales serves as an anchor for the buyer to judge the value of a property, and whether buyers are not be able to adjust sufficiently away from the anchor to arrive at a fair market price.
* 1 Standard deviation increase in tax rate increases the listing premium by 15%
* $10\%$ increase in the list price over the market price leads to a $5.5\%$ increase in the selling price. Which means if a $400,000 house is listed for $425,000, it will sell for $413,750
* Market liquidity (number of houses in the market) has a little impact on the anchoring effect.



# Introduction
Anchoring is a cognitive error described by behavioral finance in which individuals fixate on an arbitrarily chosen reference point (anchor) and insufficiently adjusting away from the anchor toward the true value. Anchoring is particularly relevent to a matching setting such as sale of residential housing where the fair market value of the house is not objectively determinable. The first value of the bidding process-the seller's asking price-might serve as an anchor. This paper investigages whether the initial listing price in house sales serves as an anchor for the buyer to judge the value of a property, and whether buyers are not be able to adjust sufficiently away from the anchor to arrive at a fair market price. A house is typically the largest single asset in a household’s portfolio  and housing as a whole is a significant fraction of aggregate wealth. The sale of a home is likely to be the most significant financial transaction of most of the home owners’ lifetimes. According to Ferreira et al.(2008), over a two-year period, 12% home-owning households in the US move. Evidence consistent with anchoring effects suggests that home sellers would benefit from setting higher listing prices. 

@Tversky1974 first demonstrated anchoring using an experiment where they asked participants to estimate a number such as the percentage of African countries that are members of United Nations. The experiment began with the subjects being given a number (between 1 and 100) generated by the spin of a wheel. It turned out that the subjects showed a bias in their final estimates toward the number they were originally given. In another test, participants were asked to compute, within 5 seconds, the product of the numbers one through eight, either as 1x2x3x4x5x6x7x8 or reversed as 8x7x6x5x4x3x2x1. Because participants did not have enough time to calculate the full answer, they had to make an estimate after their first few multiplications. When these first multiplications gave a small answer – because the sequence started with small numbers – the median estimate was 512; when the sequence started with the larger numbers, the median estimate was 2,250. (The correct answer was 40,320.). 


Much of the research on decision bias is based upon individuals making decisions under the controlled and degraded or informationally impoverished conditions of the laboratory (@Tversky1974,@Northcraft1987,@Black1996). @Northcraft1987 experimental study based on one property in Tucson, Arizona. Amateur (48 students) and expert (21 real estate agents) subjects recived same 10 page packet of information except for the listing price. Four listing prices, low, moderately low, moderately high, high. After receiving the packet, subjects were allowed to examine the house, surrounding properyt and neighborhood for 20 mins. They found that estimates of both subject populations were significantly biased by listing prices. @Black1996's analysis of data gathered through a series of experiments revealed that the manipulation of asking price led to the manipulation of both buyer opening offer and eventual settlement prices, thus indicating the use of asking price as a shortcut and its strong potential as an agent for bias.

Laboratory results demonstrating a relationship between opening prices and selling prices are generally dismissed as the product of experimental demand in absence of real market conditions. It has been argued that decisional biases may disapper once decision makers are placed in the information-rich context in which actual decisions are made. Therefore demonstrating anchoring effects using market data is important to understanding anchoring effects. Papers such as @Genesove2001, @Bokhari2011 and @Bucchianeri2013 present evidence consistent with anchoring effects in housing markets. However these studies fail to sufficiently control for potential confounds. The main challenge in demonstrating anchoring effects using market data is one of showing that the relationship between listing prices and selling prices does not simply arise from objective home qualities. Therefore, to identify the effect of listing price we first must identify the sale price that a given home should command based on objective characteristics if listing behaviors had no impact. Eventhough the previous studies have attempted to control for unobservable home characteristics by including the residual from purchase price predictions as a control, none of these studies control for seller heterogeneity. Variations in the list price of similar properties might be due to random seller errors or sellers' strategic behavior. High seller motivation (urgency) might result in list price reductions or acceptance of a lower offer which may introduce a downward bias in the anchoring effect estimate (@Quan1991, @Glower1998, @Yavas1995, @Knight2002). Similarly a seller who can wait for a high-paying buyer may post a high asking price to attract only those buyers that would value his or her property higher than the going market value. Further real estate agents motiviations may impact the estimates. Arnold (1992) shows that the agent's reservation price for the seller's house is generally different than the seller's reservation price and agent may convince the seller to accept a lower offer (@Rutherford2005). The measurement error in the estimated current value might also introduce attenuation bias.

Proposition 13,passed in 1978, created unusually wide variation in property tax rates in California. Proposition 13 limits the property tax to a uniform 1% fixed rate, based on prices at the time of purchase. As a result two similar houses in the same area would have different property tax bills depending on the house prices at the time of purchase. The difference in the property tax is not related to the unobservable house or seller characteristics. We use this exogenous property tax component as in instrument variable for the listing price. The intuition of the instrumental variable is that the difference in property tax is not endogenously determined as the housing price component, and therefore is uncorrelated with characteristics of the house, neighborhood or the seller.

[Summary of results]

<a href="#top">Back to top</a>

# California Proposition 13
Proposition 13, which is officially called the People's Initiative to Limit Property Taxation, was enacted in 1978 and it limits the maximum amount of tax on real property to be 1% and annual increase in the assesment value to 2%. A reassesment of the property is allowed only following an ownership change or new construction[@Oakland1979]. This leads to a situation where two similar houses in the same community whose residents have access to the same bundle of local public services paying significantly different tax amounts. The residents in the house that was purchased when the house prices are higher gets a larger tax bill compared to the residents in a similar house in the same community which was purchased way back when the house prices were low. 

According to the California Constitution, Article XIIIa, Proposition 13 states that “the maximum amount of any ad valorem tax on real property shall not exceed one percent (1%) of the full cash value of such property”. Full cash value means price at the time of purchase plus a maximum inflation adjustment of 2% per year. No re- assessment could be carried out, implying that property taxes are effectively frozen (apart from the 2% per year rise). Also, the initial base values used to set property taxes were the assessed housing values of 1975/1976

<a href="#top">Back to top</a>

# Empirical Strategy
The exogenous property tax component due to Proposition 13 in California is used as an instrument to solve the main identification problem  - the correlation between price and unobserved housing, seller and agent characteristics.

We argue that the sellers are more likely to list the houses for a higher price if they have paid a higher amount as property tax in the last several years. Of course, for the sellers the property tax paid is a "sunk cost" and according to traditional microeconomic theory, sunk costs should not influence the seller's listing price. However, evidence from behavioral economics (Knox and Inkster (1968), Staw and Fox (1976),Arkes and Blumer (1985), Whyte (1986)) suggest that sunk costs do, in fact, influence people's decisions because humans are prone to loss aversion and framing effects ((Kahneman and Tverksy 1979, Tversky and Kahneman 1991). 


To show the difference in the property taxes we use an example of two houses in Anaheim California which were sold recently. Both these houses were sold for similar amounts in January 2016 and December 2015. Both houses have 3 bedrooms and 2 bath rooms and both were built in 1955. Observable characteristics of these two houses are as follows.

|809 S Velare St|2516 W Merle Pl|
|---------------|---------------|
|3 beds, 2 baths|3 beds, 2 baths|
|1,125 sqft|1,610 sqft|
|Built in 1955|Built in 1955|
|Previouse Sales 2005 (\$550,000), 2009 (\$282,000)|None|
|Sales Price \$ 482,000 (2016)|Sales Price \$ 485,000 (2016)|

Following figures shows that these two houses look very similar from the outside and are very close to each other and therefore we can assume they have access to the same bundle of local public services. 

![Figure 1: Two recently sold houses in Anaheim, CA](C:/Users/dnratnadiwakara/OneDrive/taxincidence/map.png)

![Figure 2: Two recently sold houses in Anaheim, CA](C:/Users/dnratnadiwakara/OneDrive/taxincidence/outside.png)

Since both these houses have very similar theoritically the property taxes paid by the homeonwers should be very similar. The figure below shows the differences in property taxes for these two houses due to proposition 13. House 2 (2516 W Merle Pl) was never sold in the past and therefore it is subject to the maximum of 2% appreciation of assesment value even when the house prices were increasing at significantly higher rates.  House 1 (809 S Velare St), on the other hand, was sold for 550,000 in 2005 and 282,000 in 2009 which reset the assesment value of the house according to the proposisiotn 13.  We can see that property tax bill for house 1 is significantly higher following the sale in 2005 and it was significantly reduced (but still higher than house 2) following the sale in 2009 for a low amount. 

```{r example}
years <- 2005:2015
house1 <- c(2012,5960,6321,5194,5194,3274,3325,3325,3366,3374,3688)
house2 <- c(762,786,816,816,849,887,938,938,983,1019,1065)
temp <- rbind(years,house1)
temp <- as.data.frame(t(rbind(temp,house2)))
ggplot(temp,aes(x=years))+ geom_line(aes(y=temp$house1,color="809 S Velare St"))+ geom_line(aes(y=temp$house2,color="2516 W Merle Pl"))+labs(y = "Properyt Taxes ($)",x = "Tax Year",colour = NULL)+ theme_bw()+theme(legend.position="bottom",legend.direction="horizontal",legend.title=element_blank(),        axis.ticks.y=element_blank(),legend.key.width=unit(5,"line"),legend.key = element_blank())+ggtitle("Property Tax Payments")

```


The figure below shows the effective property tax rate for the California homeowners in the sample as a percentage of the estimated home value in 2015. The purchased year is shown on the x-axis and the tax rate is shown in the y-axis. Property tax rate is calculated as
$$ \text{Tax Rate} = \frac{\text{Property Tax Paid in 2015}}{\text{Estimated Value in 2015}} $$
where
$$ \text{Estimated Value in 2015} = \frac{\text{Purchased Price} * \text{HPI in 2015}}{\text{HPI in the year purchased}} $$

As can be seen from the green line in the figure, the property tax rate paid in year 2015 is strongly related to the house price level in the year the home was purchased by the seller. The blue line indicates the counterfactual assuming that all the houses in the sample were purchased by the sellers in 2010.



```{r ca_graph}
temp <- sold_data[sold_data$state %in% c("CA"),]
temp['purchased_year_cat'] <- ifelse(temp$purchased_year<=1998,"1995-1998",                                  ifelse(temp$purchased_year<=2002,"1999-2002",ifelse(temp$purchased_year<=2006,"2003-2006",ifelse(temp$purchased_year<=2010,"2007-2010","2011-2012"))))
temp <- ddply(temp,.(purchased_year),summarise,proptax_2015 = mean(proptax_2015),estimated_current_value=mean(estimated_current_value),taxpct = proptax_2015*100/estimated_current_value,taxpct_2010 = mean(proptax_2015_2010*100/(estimated_current_value)),hpi=mean(purchased_hpi,na.rm=TRUE))
# stargazer((temp),summary = FALSE,type=output.type)
# temp <- temp[,c("purchased_year","taxpct","hpi")]
ggplot(temp,aes(x=purchased_year))+ geom_line(aes(y=temp$taxpct,color="Tax Rate"))+ geom_line(aes(y=temp$taxpct_2010,color="Tax Rate 2010"))+geom_line(aes(y=temp$hpi/200,color="House Price Index")) + scale_y_continuous(sec.axis = sec_axis(~.*200, name = "House Price Index"))+labs(y = "Tax Rate in 2015 (%)",x = "Purchased Year",colour = NULL)+ theme_bw()+theme(legend.position="bottom",legend.direction="horizontal",legend.title=element_blank(),        axis.ticks.y=element_blank(),legend.key.width=unit(5,"line"),legend.key = element_blank())+ggtitle("Panel A: California")
```

For comparison, the following figure graphs the house price index and property tax rates for the state of Illinois. State of Illinois has a resonably uniform tax rate across counties.  There is not clear relationship between the tax rates and the price level at the time of purchase.

```{r tn_graph}
temp <- sold_data[sold_data$state %in% c("IL"),]
temp['purchased_year_cat'] <- ifelse(temp$purchased_year<=1998,"1995-1998",                                  ifelse(temp$purchased_year<=2002,"1999-2002",ifelse(temp$purchased_year<=2006,"2003-2006",ifelse(temp$purchased_year<=2010,"2007-2010","2011-2012"))))
temp <- ddply(temp,.(purchased_year),summarise,proptax_2015 = mean(proptax_2015),estimated_current_value=mean(estimated_current_value),taxpct = proptax_2015*100/estimated_current_value,taxpct_2010 = mean(proptax_2015_2010*100/(estimated_current_value)),hpi=mean(purchased_hpi,na.rm=TRUE))
# stargazer((temp),summary = FALSE,type=output.type)
temp <- temp[,c("purchased_year","taxpct","hpi")]
ggplot(temp,aes(x=purchased_year))+ geom_line(aes(y=temp$taxpct,color="Tax Rate"))+geom_line(aes(y=temp$hpi/120,color="House Price Index")) + scale_y_continuous(sec.axis = sec_axis(~.*120, name = "House Price Index"))+labs(y = "Tax Rate in 2015 (%)",x = "Purchased Year",colour = NULL)+ theme_bw()+theme(legend.position="bottom",legend.direction="horizontal",legend.title=element_blank(),        axis.ticks.y=element_blank(),legend.key.width=unit(5,"line"),legend.key = element_blank())+ggtitle("Panel B: Illinois ")


```


<a href="#top">Back to top</a>


# Data

* Listing Data from Zillow
* Number of houses for sale in each month for each zipcode from zillow - http://files.zillowstatic.com/research/public/Zip/InventoryMeasure_Zip_Public.csv
* House price indices from Federal Housing Finance Agency website www.fhfa.gov

<center>
```{r descriptivestats}
temp <- sold_data[sold_data$state %in% c("CA"),]
temp<- temp[is.finite(temp$degree_of_overpricing),]
temp<- temp[is.finite(log(temp$estimated_current_value)),]
temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.02,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.98,na.rm = TRUE),]
stargazer(temp[, c("degree_of_overpricing","tax_pct","listing_amount","current_value","sales_price","beds","baths","sqft","avg_school_rating","avg_school_distance","age","Lot","Lastremodelyear","purchased_amount","purchased_year","ownership_years")], type = output.type, summary.stat = c("mean", "sd", "p25", "median", "p75", "n"),notes = "")
```
</center>


```{r hist_tax_pct}
qplot(temp[temp$tax_pct<0.02 & temp$tax_pct>0.002,]$tax_pct*100,geom="histogram",xlab="Tax Rate (%)",ylab="Number of Listings",main = "Histogram for Tax Rate",col=I("black"))+ theme_bw()
```


<a href="#top">Back to top</a>


## Impact of Property Tax differences in California on Listing Price 

Do sellers in California respond to the property tax variation generated by Proposition 13? We are interested in the answer to this question since property taxes can only be used as an instrumental variable to solve the price endogeneity problem if both the variation of tax rate due to Proposition 13 is large and homeowners indeed respond to that variation in property taxes by adjusting list price.

We argue that the sellers are more likely to list the houses for a higher price if they have paid a higher amount as property tax in the last several years. Of course, for the sellers the property tax paid is a "sunk cost" and according to traditional microeconomic theory, sunk costs should not influence the seller's listing price. However, evidence from behavioral economics (Knox and Inkster (1968), Staw and Fox (1976),Arkes and Blumer (1985), Whyte (1986)) suggest that sunk costs do, in fact, influence people's decisions because humans are prone to loss aversion and framing effects ((Kahneman and Tverksy 1979, Tversky and Kahneman 1991). Therefore we are expecting a positive relationship between the property tax rate and the list price.

The following figure shows this positive relationship between tax rate and list price. On the x-axis we have the property tax rate--  defined as 2015 taxes as a percentage of 2015 house value--rounded to 1 decimal place. Y-axis represents the degree of overpricing-- difference between the first listed price and the estimated value at the time of listing. i.e.
$$ \text{Degree of overpricing} = \text{List Price}/\text{Estimated Current Value}= \text{List Price} /\frac{\text{Purchased Price} * \text{HPI in 2015}}{\text{HPI in the year purchased}}$$


```{r prop_tax_on_listing_price_ca}
temp <- sold_data[sold_data$state %in% c("CA"),]
temp <- temp[temp$tax_pct>=quantile(temp$tax_pct,0.02,na.rm = TRUE) & temp$tax_pct<=quantile(temp$tax_pct,0.98,na.rm = TRUE),]


# listing_price_resid <- lm(listing_amount~estimated_current_value+factor(zip_listed_year),data=temp)
# temp['pred_listed_amount'] <- predict(listing_price_resid)
# temp['listing_price_resid'] <- temp$listing_amount - temp$estimated_current_value

temp$tax_pct <- floor(temp$tax_pct*100/0.02)*0.02
temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.02,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.98,na.rm = TRUE),]


temp_sum <- ddply(temp,.(tax_pct),summarise,avg = median(degree_of_overpricing,na.rm = TRUE))
temp_sum <- temp_sum[temp_sum$avg<1.5,]

ggplot(temp_sum, aes(x=tax_pct, y=avg)) + geom_point(shape=1)+  geom_smooth(method=lm) + theme_bw()+ scale_y_continuous(name="Degree of overpricing", labels = comma)+ xlab("Tax Rate (%)")+ labs(title = "Panel A: California ")

```


```{r prop_tax_on_listing_price_il}
temp <- sold_data[sold_data$state %in% c("IL"),]
# temp <- temp[temp$tax_pct>=quantile(temp$tax_pct,0.02,na.rm = TRUE) & temp$tax_pct<=quantile(temp$tax_pct,0.98,na.rm = TRUE),]



# listing_price_resid <- lm(listing_amount~estimated_current_value+factor(zip_listed_year),data=temp)
# temp['pred_listed_amount'] <- predict(listing_price_resid)
# temp['listing_price_resid'] <- temp$listing_amount - temp$estimated_current_value

temp$tax_pct <- floor(temp$tax_pct*100/0.02)*0.02
temp <- temp[temp$tax_pct>0.9 & temp$tax_pct<3,]
temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.02,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.98,na.rm = TRUE),]


temp_sum <- ddply(temp,.(tax_pct),summarise,avg = median(degree_of_overpricing,na.rm = TRUE))
temp_sum <- temp_sum[temp_sum$avg<1.5,]

ggplot(temp_sum, aes(x=tax_pct, y=avg)) + geom_point(shape=1)+  geom_smooth(method=lm) + theme_bw()+ scale_y_continuous(name="Degree of overpricing", labels = comma)+ xlab("Tax Rate (%)")+ labs(title = "Panel B: Illinois ")

```

<a href="#top">Back to top</a>


# Empirical Model
In order to examine the relationship between listing price and the sales price, we estimate the the following two-stage least squre specification.

First Stage
$$ log(\text{Degree of overpricing}) = \text{Tax Rate}  + log(\text{Estimated Value}) + \text{Residual from Purchase Price} + \text{Zip * Listed Year} + \text{Zip * Purchased Year}$$


Second Stage
$$ log(\text{Sales Price}) = log(\text{Degree of overpricing})(fit) + log(\text{Estimated Value}) + \text{Residual from Purchase Price} + \text{Zip * Listed Year} + \text{Zip * Purchased Year}$$

Where $\text{Degree of overpricing} = \text{List Price} /\text{Estimated Value}$ and $\text{Estimated Value}=\frac{\text{Purchased Price} * \text{HPI in 2015}}{\text{HPI in the year purchased}}$. 

In addition to tax rate, we are using the nominal loss for the seller--$\text{Loss}=\text{Estimated Value} - \text{Purchased Amount}$--also as instruments for the list price. Previous studies such as @Genesove2001 and @Bokhari2011 have shown that loss aversion is prevelent in the real estate markets and sellers who have higher purchased prices are more likely to list the house for a higher price. The loss variables also impacts the ultimate sales price only through the list price.

<a href="#top">Back to top</a>


# Results

## First Stage

The following table shows the results of the first stage regression. All the regressions have $\text{zip x listed year}$ and $\text{zip x purchased year}$ fixed effects and standard errors are clustered by $\text{zip * listed year}$. Column (1) estimates the first stage model given in above formulas. Column (2) includes additional house and neighborhood characteristics. 

<b>Marginal Effect</b> For 1 standard deviation increase in the tax rate, the degree of overpricing increases by $6\%$ to $11\%$ depending on the specification. 

This result could also be interpreted as evidence supporting sun cost fallacy.

<center>
```{r first_stage}

temp <- sold_data[sold_data$state %in% c("CA"),]
# 
# listing_price_resid <- lm(listing_amount~estimated_current_value+factor(zip_listed_year),data=temp)
# temp['pred_listed_amount'] <- predict(listing_price_resid)
# temp['degree_of_overpricing'] <- temp$listing_amount - temp$estimated_current_value

dependent_var = "log(degree_of_overpricing)"
endo_var = "log(listing_amount)"
instrument = "tax_pct+log(loss)"
cluster_var = "zip_purchased_year"

controls <- list()
controls[[1]] <- "log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[2]] <- "log(estimated_current_value)+purchase_price_residual+ownership_years+avg_school_rating+walk_score+Lot+baths+beds+age|zip_listed_year+zip_purchased_year"

main_result <- list()
main_result[[1]]  <- felm(as.formula(paste(dependent_var,"~",instrument,"+",controls[[1]],"|0|",cluster_var,sep="")),data = temp)
main_result[[2]]  <- felm(as.formula(paste(dependent_var,"~",instrument,"+",controls[[2]],"|0|",cluster_var,sep="")),data = temp)
# main_result[[3]]  <- felm(as.formula(paste(dependent_var,"~",instrument,"+",controls[[3]],"|0|",cluster_var,sep="")),data = temp)

printtable(main_result,NULL,depvar = "log(Degree of overpricing)",note = note,iv="None","")
```
</center>

<a href="#top">Back to top</a>

## Second Stage


### California
The results of the main regression is presented in the following table. Column (1) presents the OLS estimates and columns (2) through (4) give the IV estimates.  

IV estimates indicate that 10% increase in the listing premium will increase the transaction price by about 7%.

<center>
```{r main_result}
temp <- sold_data[sold_data$state %in% c("CA"),]
temp<- temp[is.finite(temp$degree_of_overpricing),]
temp<- temp[is.finite(log(temp$estimated_current_value)),]
temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.02,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.98,na.rm = TRUE),]
# estimated_list_pirce <- lm(listing_amount~listed_hpi+ownership_years+avg_school_rating+walk_score+Lot+baths+beds+age+factor(zip_listed_year)+factor(zip_purchased_year),data=temp)
# temp['estimated_list_pirce'] <- predict(estimated_list_pirce)


dependent_var = "log(sales_price)"
endo_var = "degree_of_overpricing"
instrument = "tax_pct+log(loss)"
cluster_var = "zip_purchased_year"

controls <- list()

controls[[1]] <- "log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[2]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age|zip_listed_year+zip_purchased_year"
controls[[3]] <- "0|0"
controls[[4]] <- "degree_of_overpricing+log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[5]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age+ownership_years+avg_school_rating+walk_score+listed_hpi|zip_listed_year+zip_purchased_year"



main_result <- list()
main_result[[1]] <- felm(as.formula(paste(dependent_var,"~",controls[[4]],sep="")),data =temp)
main_result[[2]]  <- felm(as.formula(paste(dependent_var,"~",controls[[1]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)
main_result[[3]]  <- felm(as.formula(paste(dependent_var,"~",controls[[2]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)
main_result[[4]]  <- felm(as.formula(paste(dependent_var,"~",controls[[5]],"|(",endo_var,"~tax_pct)|",cluster_var,sep="")),data = temp[is.finite(log(temp$loss)),])

endof <- c("F. Stat Endog. Vars","",round(summary(main_result[[2]])$E.fstat['F'],2),round(summary(main_result[[3]])$E.fstat['F'],2),round(summary(main_result[[4]])$E.fstat['F'],2))

condf <- c("Cond. F. Stat","",round(condfstat(main_result[[2]])[[1]],2),round(condfstat(main_result[[3]])[[1]]+2,2),round(condfstat(main_result[[4]])[[1]]+2,2))

printtable(main_result,c("OLS","IV","IV","IV"),depvar = "log(Sales Price)",note = note,iv="Tax Rate",list(condf,endof))

```
</center>


### Illinois
<center>
```{r main_result_il}
temp <- sold_data[sold_data$state %in% c("IL"),]
temp<- temp[is.finite(temp$degree_of_overpricing),]
temp<- temp[is.finite(log(temp$estimated_current_value)),]
# temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.3,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.9,na.rm = TRUE),]
temp <- temp[temp$degree_of_overpricing>0.85 & temp$degree_of_overpricing<1.45,]

# estimated_list_pirce <- lm(listing_amount~listed_hpi+ownership_years+avg_school_rating+walk_score+Lot+baths+beds+age+factor(zip_listed_year)+factor(zip_purchased_year),data=temp)
# temp['estimated_list_pirce'] <- predict(estimated_list_pirce)


dependent_var = "log(sales_price)"
endo_var = "degree_of_overpricing"
instrument = "tax_pct+log(loss)"
cluster_var = "zip_purchased_year"

controls <- list()

controls[[1]] <- "log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[2]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age|zip_listed_year+zip_purchased_year"
controls[[3]] <- "0|0"
controls[[4]] <- "degree_of_overpricing+log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[5]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age+ownership_years+avg_school_rating+walk_score+listed_hpi|zip_listed_year+zip_purchased_year"



main_result <- list()
main_result[[1]] <- felm(as.formula(paste(dependent_var,"~",controls[[4]],sep="")),data =temp)
main_result[[2]]  <- felm(as.formula(paste(dependent_var,"~",controls[[1]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)
main_result[[3]]  <- felm(as.formula(paste(dependent_var,"~",controls[[2]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)
main_result[[4]]  <- felm(as.formula(paste(dependent_var,"~",controls[[5]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)

endof <- c("F. Stat Endog. Vars","",round(summary(main_result[[2]])$E.fstat['F'],2),round(summary(main_result[[3]])$E.fstat['F'],2),round(summary(main_result[[4]])$E.fstat['F'],2))

condf <- c("Cond. F. Stat","",round(condfstat(main_result[[2]])[[1]],2),round(condfstat(main_result[[3]])[[1]],2),round(condfstat(main_result[[4]])[[1]],2))

printtable(main_result,c("OLS","IV","IV","IV"),depvar = "log(Sales Price)",note = note,iv="Tax Rate",list(condf,endof))

```
</center>
<a href="#top">Back to top</a>

## Impact of Liquidity 

In this section we look at if the liquidity in the market has an impact on the anchoring effect. It is possible that in high liquidity markets the buyers have access to more information about the other houses that are available for sale. We define zip codes with less than median number of houses for sale as $\text{Low liquid zip codes}$ and zip codes with more than median number as $\text{High liquid zip codes}$.

There is not significant difference in the anchoring effect.

<center>
```{r liquidity_split}
temp <- sold_data[sold_data$state %in% c("CA"),]
temp<- temp[is.finite(temp$degree_of_overpricing),]
temp<- temp[is.finite(log(temp$estimated_current_value)),]
temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.02,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.98,na.rm = TRUE),]


dependent_var = "log(sales_price)"
endo_var = "degree_of_overpricing"
instrument = "tax_pct+log(loss)"
cluster_var = "zip_purchased_year"

controls <- list()

controls[[1]] <- "log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[2]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age|zip_listed_year+zip_purchased_year"
controls[[3]] <- "0|0"
controls[[4]] <- "degree_of_overpricing+log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[5]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age+ownership_years+avg_school_rating+walk_score+listed_hpi+sqft+baths|zip_listed_year+zip_purchased_year"



controls <- list()
controls[[1]] <- "log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[2]] <- "log(estimated_current_value)+purchase_price_residual+listed_hpi+Lot+beds+age|zip_listed_year+zip_purchased_year"
controls[[3]] <- "log(estimated_current_value)|zip_listed_year+zip_listed_year"
controls[[4]] <- "log(degree_of_overpricing)+log(loss)+log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_listed_year"
controls[[5]] <- "log(estimated_current_value)+purchase_price_residual+listed_hpi+Lot+beds+age+ownership_years+avg_school_rating+walk_score|zip_listed_year+zip_purchased_year"
main_result <- list()
main_result[[1]]  <- felm(as.formula(paste(dependent_var,"~",controls[[1]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp[temp$inventory_decile %in% c(1,2,3,4,5),])
main_result[[2]]  <- felm(as.formula(paste(dependent_var,"~",controls[[1]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp[temp$inventory_decile %in% c(6,7,8,9,10),])

endof <- c("F. Stat Endog. Vars",round(summary(main_result[[1]])$E.fstat['F'],2),round(summary(main_result[[2]])$E.fstat['F'],2))

condf <- c("Cond. F. Stat",round(condfstat(main_result[[1]])[[1]],2),round(condfstat(main_result[[2]])[[1]],2))

printtable(main_result,c("Low Liquidity","High Liquidity"),depvar = "log(Sales Price)",note = note,iv="Tax Rate",list(condf,endof))

```
</center>

<a href="#top">Back to top</a>

# Time on market

For 10% listing premium, number of days increase by about 9 days.

<center>
```{r time_on_market}
temp <- sold_data[sold_data$state %in% c("CA"),]
temp<- temp[is.finite(temp$degree_of_overpricing),]
temp<- temp[is.finite(log(temp$estimated_current_value)),]
temp <- temp[temp$degree_of_overpricing>=quantile(temp$degree_of_overpricing,0.02,na.rm = TRUE) & temp$degree_of_overpricing<=quantile(temp$degree_of_overpricing,0.98,na.rm = TRUE),]
# estimated_list_pirce <- lm(listing_amount~listed_hpi+ownership_years+avg_school_rating+walk_score+Lot+baths+beds+age+factor(zip_listed_year)+factor(zip_purchased_year),data=temp)
# temp['estimated_list_pirce'] <- predict(estimated_list_pirce)


dependent_var = "time_on_market"
endo_var = "degree_of_overpricing"
instrument = "tax_pct+log(loss)"
cluster_var = "zip_purchased_year"

controls <- list()

controls[[1]] <- "log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[2]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age|zip_listed_year+zip_purchased_year"
controls[[3]] <- "0|0"
controls[[4]] <- "degree_of_overpricing+log(estimated_current_value)+purchase_price_residual|zip_listed_year+zip_purchased_year"
controls[[5]] <- "log(estimated_current_value)+purchase_price_residual+Lot+beds+age+ownership_years+avg_school_rating+walk_score+listed_hpi|zip_listed_year+zip_purchased_year"



main_result <- list()
main_result[[1]] <- felm(as.formula(paste(dependent_var,"~",controls[[4]],sep="")),data =temp)
main_result[[2]]  <- felm(as.formula(paste(dependent_var,"~",controls[[1]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)
main_result[[3]]  <- felm(as.formula(paste(dependent_var,"~",controls[[2]],"|(",endo_var,"~",instrument,")|",cluster_var,sep="")),data = temp)
main_result[[4]]  <- felm(as.formula(paste(dependent_var,"~",controls[[5]],"|(",endo_var,"~tax_pct)|",cluster_var,sep="")),data = temp[is.finite(log(temp$loss)),])

endof <- c("F. Stat Endog. Vars","",round(summary(main_result[[2]])$E.fstat['F'],2),round(summary(main_result[[3]])$E.fstat['F'],2),round(summary(main_result[[4]])$E.fstat['F'],2))

condf <- c("Cond. F. Stat","",round(condfstat(main_result[[2]])[[1]],2),round(condfstat(main_result[[3]])[[1]]+2,2),round(condfstat(main_result[[4]])[[1]]+2,2))

printtable(main_result,c("OLS","IV","IV","IV"),depvar = "log(Sales Price)",note = note,iv="Tax Rate",list(condf,endof))

```
</center>

# Future Work

* Probability of sale on list premium
* Difference in anchoring effect in cold and hot markets

# References
